[build]
  # Build command to inject environment variables into source files
  command = "npm install && npm run build"
  publish = "."

[build.environment]
  # Node version (optional, for any build tools you might add)
  NODE_VERSION = "18"
  # Disable smart secrets detection - we intentionally inject secrets during build
  # The build script replaces placeholders with actual values from environment variables
  # This is expected behavior for our deployment process
  SECRETS_SCAN_SMART_DETECTION_ENABLED = "false"

# ============================================================================
# REQUIRED ENVIRONMENT VARIABLES
# ============================================================================
# These environment variables MUST be set in Netlify Dashboard:
# Go to: Site Settings → Environment Variables
#
# Required Firebase variables (all must be set):
#   - VITE_FIREBASE_API_KEY
#   - VITE_FIREBASE_AUTH_DOMAIN
#   - VITE_FIREBASE_PROJECT_ID
#   - VITE_FIREBASE_STORAGE_BUCKET
#   - VITE_FIREBASE_MESSAGING_SENDER_ID
#   - VITE_FIREBASE_APP_ID
#   - VITE_FIREBASE_MEASUREMENT_ID
#
# Optional variables:
#   - VITE_GITHUB_TOKEN (optional, but recommended for higher API rate limits)
#
# How to get Firebase credentials:
#   1. Go to Firebase Console: https://console.firebase.google.com/
#   2. Select your project
#   3. Go to Project Settings → General
#   4. Scroll to "Your apps" section
#   5. Copy the configuration values
#
# IMPORTANT: The build will FAIL if required environment variables are missing.
# The build script validates all required variables before proceeding.
# ============================================================================

# Branch deploy configuration
[build.processing]
  skip_processing = false

# Automatic preview deployments for all branches and PRs
# No manual approval needed for preview deployments
[context.branch-deploy]
  command = "npm install && npm run build"
  publish = "."

[context.deploy-preview]
  command = "npm install && npm run build"
  publish = "."

# Production deployment only on main branch (after PR merge)
[context.production]
  command = "npm install && npm run build"
  publish = "."

# Production branch settings
[context.production.environment]
  NODE_ENV = "production"

# Branch protection - only main branch can deploy to production
# All other branches get preview deployments automatically

# Automatic preview deployments (no approval needed)
# These settings ensure:
# - All PRs get preview deployments automatically
# - Preview deployments don't require manual approval
# - Production only deploys when PR is merged to main

# Redirect rules
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Headers for static assets
[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

