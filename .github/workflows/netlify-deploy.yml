name: Netlify Deploy Status

on:
  pull_request:
    types: [opened, synchronize, reopened, closed]
  push:
    branches: [main]

jobs:
  notify:
    name: Netlify Deploy Status
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Comment PR
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const prAuthor = context.payload.pull_request.user.login;
            
            if (context.payload.action === 'opened' || context.payload.action === 'synchronize') {
              const commentBody = [
                '## üöÄ Preview Deployment',
                '',
                'A preview deployment is being created automatically on Netlify.',
                '',
                '**Preview URL**: Will be available once Netlify finishes building (usually takes 1-2 minutes)',
                '',
                '**Note**:',
                '- ‚úÖ Preview deployments are automatic (no approval needed)',
                '- ‚è≥ Production deployment will happen automatically after this PR is merged to `main`',
                '- üîí Only merged PRs deploy to production',
                '',
                '**Status**: Netlify is building your preview...'
              ].join('\n');
              
              github.rest.issues.createComment({
                issue_number: prNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: commentBody
              });
            }
      
      - name: Success Message
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: |
          echo "‚úÖ Code pushed to main branch"
          echo "üöÄ Production deployment will be triggered on Netlify"

